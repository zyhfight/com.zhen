<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0" />
    <title>学生综合能力管理系统</title>

    <link rel="stylesheet" type="text/css" href="../../static/util/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../static/util/css/sweet-alert.css" />
    <link rel="stylesheet" type="text/css" href="../../static/css/student_info.css" />

</head>

<body>

<div>

    <div align="right" style="margin-top: 6rem;margin-right: 4rem;font-size: xx-large;color: #5bc0de;cursor: pointer" data-toggle="modal" data-target="#myModal3" onclick="addSubjectScoreModal()" >+Add</div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top: 6rem">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        <!--新增学生信息-->
                    </h4>
                </div>
                <div class="modal-body" id="modalBody">
                    <!--在这里添加一些文本-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>



    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal2" style="margin-top: 6rem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel2">
                        <!--模态框（Modal）标题-->
                    </h4>
                </div>
                <div class="modal-body" id="modalBody2">
                    <!--在这里添加一些文本-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <!--<button type="button" class="btn btn-primary" onclick="updateStudentInfo()">-->
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="updateEvaluate()">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>


    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal3" style="margin-top: 6rem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel3">
                        <!--模态框（Modal）标题-->
                    </h4>
                </div>
                <div class="modal-body" id="modalBody3">
                    <!--在这里添加一些文本-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <!--<button type="button" class="btn btn-primary" onclick="updateStudentInfo()">-->
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="addSubjectScore()">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>


    <table class="table" border="1" style="margin-top: 2rem;width: 80%" align="center">
        <thead>
        <tr>
            <th class="th">学号</th>
            <th class="th">评价描述</th>
            <th class="th">评价得分</th>
            <th class="th">编辑</th>
            <th class="th">删除</th>
        </tr>
        </thead>

        <tbody id="subjectScore">

        </tbody>
    </table>

</div>



<script src="../../static/util/js/jquery.min.js"></script>
<script src="../../static/util/js/bootstrap.min.js"></script>
<script src="../../static/util/js/sweet-alert.min.js"></script>

<script>

    $(function() {

        getEvaluate();

    });



    function getEvaluate() {
        var userList="";
        $.get("/admin/getAllEvaluate",  {}, function (data) {
            userList = eval("("+data.data+")");

            var html="";
            for(var key in userList){
                var obj = userList[key];
                html+="<tr>" +"<td class='td'>"+obj.studentId+"</td>"+
                    "<td class='td'>"+obj.evaluateDescription+"</td>"+
                    "<td class='td'>"+obj.evaluateScore+"</td>"+
                    "<td class='tk' data-toggle=\"modal\" data-target=\"#myModal2\" onclick=showModal('"+obj.studentId+"',"+"'edit'"+")>编辑</td>"+
                    "<td class='tk' onclick=deleteEvaluate('"+obj.studentId+"')>删除</td>"+
                    "</tr>"
            }
            document.getElementById("subjectScore").innerHTML=html;
            if(userList.length==0){
                swal("无信息");
                return;
            }
        });
        console.log(userList);
        return userList;
    }


    function showModal(studentId,type) {
        console.log(studentId);
        if(type == "edit"){

            document.getElementById("myModalLabel2").innerHTML = "编辑学生成绩信息";
            var html = "";

            $.get("/admin/getEvaluate", {studentId: studentId}, function (data) {

                var obj = eval("(" + data.data + ")");

                html+= "<input type='text' hidden id='id' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' value="+obj.studentId+">"+
                    "评价描述:<input type='text' maxlength='2' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='evaluateDescription' value="+obj.evaluateDescription+">"+
                    "评价得分;<input type='text' maxlength='3' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='evaluateScore' value="+obj.evaluateScore+">";

                document.getElementById("modalBody2").innerHTML = html;

            });

        }
    }

    function addSubjectScoreModal() {

        document.getElementById("myModalLabel3").innerHTML = "新增学生评价信息";
        var html = "";

        html+="学号;<input type='text' required id='id1' style='width: 100%;height: 3rem;margin-bottom: 1rem;'>"+
            "评价描述;<input type='text' required maxlength='10' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='evaluateDescription1'>"+
            "评价得分:<input type='text' required maxlength='2' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='evaluateScore1' >";
        document.getElementById("modalBody3").innerHTML = html;
    }


    function addSubjectScore() {

        var studentId = document.getElementById("id1").value;


        $.get("/admin/getStudentInfo", {studentId: studentId}, function (data) {

            var obj = eval("(" + data.data + ")");
            if(obj==null){
                swal("该学号学生不存在!");
                return;
            }

        });
        $.get("/admin/getEvaluate", {studentId: studentId}, function (data) {

            var obj = eval("(" + data.data + ")");
            if(obj!=null){
                swal("该学号学生评价信息已存在!");
                return;
            }

        });


        var evaluateDescription = document.getElementById("evaluateDescription1").value;
        var evaluateScore = document.getElementById("evaluateScore1").value;

        if(studentId==""||evaluateDescription==""||evaluateScore==""){
            swal("有选项未填写");
            return;
        }

        if(evaluateScore<0||evaluateScore>100){
            swal("分数应在0-100");
            return;
        }

        $.post("/admin/addEvaluate",{
                studentId: studentId,
                evaluateDescription: evaluateDescription,
                evaluateScore: evaluateScore
            },
            function (data) {
                if(data!=null&&data.data=="OK"){

                    swal("新增成功");
                    getEvaluate();

                }else{
                    swal("新增失败");
                }
            });
    }

    function  updateEvaluate() {

        var studentId = document.getElementById("id").value;
        var evaluateDescription = document.getElementById("evaluateDescription").value;
        var evaluateScore = document.getElementById("evaluateScore").value;

        if(studentId==""||evaluateDescription==""||evaluateScore==""){
            swal("有选项未填写");
            return;
        }
        if(evaluateScore<0||evaluateScore>100){
            swal("分数应在0-100");
            return;
        }

        $.post("/admin/updateEvaluate",{
            studentId: studentId,
            evaluateDescription: evaluateDescription,
            evaluateScore: evaluateScore,
        },function (data) {
            if(data!=null&&data.data=="OK"){

                swal("更新成功");
                getEvaluate();

            }else{
                swal("更新失败");
            }
        });


    }
    function deleteEvaluate(studentId) {
        swal({
                title: "Are you sure?",
                text: "Your will not be able to recover this studentInfo!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!" },
            function(){
                $.get("/admin/deleteEvaluate", {studentId: studentId}, function (data) {

                    if(data!=null&&data.data=="OK"){

                        swal("删除成功");
                        getEvaluate();

                    }else{
                        swal("删除失败");
                    }
                });
            });
    }

</script>

</body>

</html>