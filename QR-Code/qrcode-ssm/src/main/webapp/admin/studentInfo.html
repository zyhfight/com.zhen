<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0" />
    <title>学生综合能力管理系统</title>

    <link rel="stylesheet" type="text/css" href="../../static/util/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../static/util/css/sweet-alert.css" />
    <link rel="stylesheet" type="text/css" href="../../static/css/student_info.css" />


</head>

<body>


    <div>

        <div align="right" style="margin-top: 6rem;margin-right: 4rem;font-size: xx-large;color: #5bc0de;cursor: pointer" data-toggle="modal" data-target="#myModal3" onclick="addStudentInfoModal()" >+Add</div>

        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top: 6rem">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                            <!--新增学生信息-->
                        </h4>
                    </div>
                    <div class="modal-body" id="modalBody">
                        <!--在这里添加一些文本-->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>



        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal2" style="margin-top: 6rem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="myModalLabel2">
                            <!--模态框（Modal）标题-->
                        </h4>
                    </div>
                    <div class="modal-body" id="modalBody2">
                        <!--在这里添加一些文本-->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                        </button>
                        <!--<button type="button" class="btn btn-primary" onclick="updateStudentInfo()">-->
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="updateStudentInfo()">
                            提交
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>


        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal3" style="margin-top: 6rem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="myModalLabel3">
                            <!--模态框（Modal）标题-->
                        </h4>
                    </div>
                    <div class="modal-body" id="modalBody3">
                        <!--在这里添加一些文本-->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                        </button>
                        <!--<button type="button" class="btn btn-primary" onclick="updateStudentInfo()">-->
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="addStudentInfo()">
                            提交
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>


        <table class="table" border="1" style="margin-top: 2rem;width: 80%" align="center">
            <thead>
                <tr>
                    <th class="th">学号</th>
                    <th class="th">姓名</th>
                    <th class="th">性别</th>
                    <th class="th">年龄</th>
                    <th class="th">籍贯</th>
                    <th class="th">学科成绩</th>
                    <th class="th">科技成果</th>
                    <th class="th">评价信息</th>
                    <th class="th">编辑</th>
                    <th class="th">删除</th>
                </tr>
            </thead>

            <tbody id="studentInfo">

            </tbody>
        </table>

    </div>



    <script src="../../static/util/js/jquery.min.js"></script>
    <script src="../../static/util/js/bootstrap.min.js"></script>
    <script src="../../static/util/js/sweet-alert.min.js"></script>

<script>

    $(function() {

        getStudentInfo();

    });

    function getStudentInfo() {
        var userList="";
        $.get("/admin/getAllUser",  {}, function (data) {

            userList = eval("("+data.data+")");

            var html="";
            for(var key in userList){
                var obj = userList[key];
                html+="<tr>" +"<td class='td'>"+obj.studentId+"</td>"+
                    "<td class='td'>"+obj.studentName+"</td>"+
                    "<td class='td'>"+obj.studentSex+"</td>"+
                    "<td class='td'>"+obj.studentAge+"</td>"+
                    "<td class='td'>"+obj.studentHome+"</td>"+
                    "<td class='tk' data-toggle=\"modal\" data-target=\"#myModal\" onclick=showModal('"+obj.studentId+"',"+"'subjectScore'"+")>查看</td>"+
                    "<td class='tk' data-toggle=\"modal\" data-target=\"#myModal\" onclick=showModal('"+obj.studentId+"',"+"'achievement'"+")>查看</td>"+
                    "<td class='tk' data-toggle=\"modal\" data-target=\"#myModal\" onclick=showModal('"+obj.studentId+"',"+"'evaluate'"+")>查看</td>"+
                    "<td class='tk' data-toggle=\"modal\" data-target=\"#myModal2\" onclick=showModal('"+obj.studentId+"',"+"'edit'"+")>编辑</td>"+
                    "<td class='tk' onclick=deleteStudentInfo('"+obj.studentId+"')>删除</td>"+
                    "</tr>"
            }
            document.getElementById("studentInfo").innerHTML=html;

            if(userList.length==0){
                swal("无信息");
                return;
            }
        });
        console.log(userList);
        return userList;
    }


    function showModal(studentId,type) {
        console.log(studentId);
        if (type == "subjectScore") {

            document.getElementById("myModalLabel").innerHTML = "学科成绩";
            var html = "";

            $.get("/admin/getSubjectScoreById", {studentId: studentId}, function (data) {

                var obj = eval("(" + data.data + ")");
                if(obj==null){
                    document.getElementById("myModalLabel").innerHTML = "无信息";
                    return;
                }

                html += "   <table class=\"table\" border=\"1\"  align=\"center\">" +
                    "<tr><td>高数</td><td>"+obj.math+"</td></tr>" +
                    "<tr><td>物理</td><td>"+obj.physical+"</td></tr>" +
                    "<tr><td>英语</td><td>"+obj.english+"</td></tr>" +
                    "</table>";
                document.getElementById("modalBody").innerHTML = html;


            });
        }else if(type == "achievement"){

            document.getElementById("myModalLabel").innerHTML = "科技成果";
            var html = "";

            $.get("/admin/getAchievementsById", {studentId: studentId}, function (data) {

                var achievements = eval("(" + data.data + ")");

                if(achievements.length==0){
                    document.getElementById("myModalLabel").innerHTML = "无信息";
                    return;
                }

                html += "<table class=\"table\" border=\"1\"  align=\"center\">";

                for(var key in achievements){

                    var obj = achievements[key];

                    html +="<tr><td>科技成果编号</td><td>"+obj.achievementId+"</td></tr>" +
                        "<tr><td>科技成果名</td><td>"+obj.achievementDescription+"</td></tr>" +
                        "<tr><td>科技成果得分</td><td>"+obj.achievementScore+"</td></tr>";

                }
                html+="</table>";

                document.getElementById("modalBody").innerHTML = html;
            });
        }else if(type == "evaluate"){

            document.getElementById("myModalLabel").innerHTML = "评价信息";
            var html = "";

            $.get("/admin/getEvaluate", {studentId: studentId}, function (data) {

                var obj = eval("(" + data.data + ")");

                if(obj==null){
                    document.getElementById("myModalLabel").innerHTML = "无信息";
                    return;
                }

                html += "   <table class=\"table\" border=\"1\"  align=\"center\">" +
                    "<tr><td>评价信息</td><td style='width: 80%;max-width: 80%'>"+obj.evaluateDescription+"</td></tr>" +
                    "<tr><td>评价得分</td><td>"+obj.evaluateScore+"</td></tr>" +
                    "</table>";
                document.getElementById("modalBody").innerHTML = html;

            });
        }else if(type == "edit"){

            document.getElementById("myModalLabel2").innerHTML = "编辑学生信息";
            var html = "";

            $.get("/admin/getStudentInfo", {studentId: studentId}, function (data) {

                var obj = eval("(" + data.data + ")");

               html+="姓名;<input type='text' maxlength='10' required='required' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='name' value="+obj.studentName+">"+
                   "<input type='text' hidden id='id' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' value="+obj.studentId+">"+
                    "性别:<input type='text' maxlength='2' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='sex' value="+obj.studentSex+">"+
                    "年龄;<input type='text' maxlength='3' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='age' value="+obj.studentAge+">"+
                    "籍贯:<input type='text' maxlength='10' required style='width: 100%;height:3rem;margin-bottom: 1rem;' id='home' value="+obj.studentHome+">";

                document.getElementById("modalBody2").innerHTML = html;

            });

        }
    }

    function addStudentInfoModal() {

        document.getElementById("myModalLabel3").innerHTML = "新增学生信息";
        var html = "";

        html+="学号;<input type='text' required id='id1' style='width: 100%;height: 3rem;margin-bottom: 1rem;'>"+
            "姓名;<input type='text' required maxlength='10' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='name1'>"+
            "性别:<input type='text' required maxlength='2' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='sex1' >"+
            "年龄;<input type='text' required maxlength='3' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='age1' >"+
            "籍贯:<input type='text' required maxlength='10' style='width: 100%;height:3rem;margin-bottom: 1rem;' id='home1' >";
        document.getElementById("modalBody3").innerHTML = html;
    }


    function addStudentInfo() {
        var studentId = document.getElementById("id1").value;
        var studentName = document.getElementById("name1").value;
        var studentSex = document.getElementById("sex1").value;
        var studentAge = document.getElementById("age1").value;
        var studentHome = document.getElementById("home1").value;

        if(studentId==""||studentName==""||studentSex==""||studentAge==""||studentHome==""){
            swal("有选项未填写");
            return;
        }

        if(studentSex!="男"&&studentSex!="女"){
            swal("性别输入有误");
            return;
        }
        if(studentAge<0||studentAge>100){
            swal("年龄输入有误");
            return;
        }

        $.post("/admin/addStudentInfo",{
            studentId: studentId,
            studentName: studentName,
            studentSex: studentSex,
            studentAge: studentAge,
            studentHome: studentHome},function (data) {
            if(data!=null&&data.data=="OK"){

                swal("新增成功");
                getStudentInfo();

            }else{
                swal("新增失败");
            }
        });
    }

    function  updateStudentInfo(type) {

            var studentId = document.getElementById("id").value;
            var studentName = document.getElementById("name").value;
            var studentSex = document.getElementById("sex").value;
            var studentAge = document.getElementById("age").value;
            var studentHome = document.getElementById("home").value;

            if(studentId==""||studentName==""||studentSex==""||studentAge==""||studentHome==""){
                swal("有选项未填写");
                return;
            }


            if(studentSex!="男"&&studentSex!="女"){
                swal("性别输入有误");
                return;
            }
            if(studentAge<0||studentAge>100){
                swal("年龄输入有误");
                return;
            }


            $.post("/admin/updateStudentInfo",{
                studentId: studentId,
                studentName: studentName,
                studentSex: studentSex,
                studentAge: studentAge,
                studentHome: studentHome},function (data) {
                if(data!=null&&data.data=="OK"){

                    swal("更新成功");
                    getStudentInfo();

                }else{
                    swal("更新失败");
                }
            });


    }
    function deleteStudentInfo(studentId) {
        swal({
                title: "Are you sure?",
                text: "Your will not be able to recover this studentInfo!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!" },
            function(){
                $.get("/admin/deleteStudentInfo", {studentId: studentId}, function (data) {

                    if(data!=null&&data.data=="OK"){

                        swal("删除成功");
                        getStudentInfo();

                    }else{
                        swal("删除失败");
                    }
                });
        });
    }

</script>

</body>

</html>