<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0" />
    <title>学生综合能力管理系统</title>

    <link rel="stylesheet" type="text/css" href="../../static/util/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../static/util/css/sweet-alert.css" />
    <link rel="stylesheet" type="text/css" href="../../static/css/student_info.css" />

</head>

<body>

<div>

    <div align="right" style="margin-top: 6rem;margin-right: 4rem;font-size: xx-large;color: #5bc0de;cursor: pointer" data-toggle="modal" data-target="#myModal3" onclick="addSubjectScoreModal()" >+Add</div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top: 6rem">
        <div cladal-dialog">
            <div clss="moass="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        <!--新增学生信息-->
                    </h4>
                </div>
                <div class="modal-body" id="modalBody">
                    <!--在这里添加一些文本-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>



    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal2" style="margin-top: 6rem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel2">
                        <!--模态框（Modal）标题-->
                    </h4>
                </div>
                <div class="modal-body" id="modalBody2">
                    <!--在这里添加一些文本-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <!--<button type="button" class="btn btn-primary" onclick="updateStudentInfo()">-->
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="updateSubjectScore()">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>


    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal3" style="margin-top: 6rem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel3">
                        <!--模态框（Modal）标题-->
                    </h4>
                </div>
                <div class="modal-body" id="modalBody3">
                    <!--在这里添加一些文本-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <!--<button type="button" class="btn btn-primary" onclick="updateStudentInfo()">-->
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="addSubjectScore()">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>


    <table class="table" border="1" style="margin-top: 2rem;width: 80%" align="center">
        <thead>
        <tr>
            <th class="th">学号</th>
            <th class="th">科技成果编号</th>
            <th class="th">科技成果描述</th>
            <th class="th">科技成果得分</th>
            <th class="th">编辑</th>
            <th class="th">删除</th>
        </tr>
        </thead>

        <tbody id="subjectScore">

        </tbody>
    </table>

</div>



<script src="../../static/util/js/jquery.min.js"></script>
<script src="../../static/util/js/bootstrap.min.js"></script>
<script src="../../static/util/js/sweet-alert.min.js"></script>

<script>

    $(function() {

        getAchievements();

    });



    function getAchievements() {
        var userList="";
        $.get("/admin/getAllAchievements",  {}, function (data) {
            userList = eval("("+data.data+")");

            var html="";
            for(var key in userList){
                var obj = userList[key];
                html+="<tr>" +"<td class='td'>"+obj.studentId+"</td>"+
                    "<td class='td'>"+obj.achievementId+"</td>"+
                    "<td class='td'>"+obj.achievementDescription+"</td>"+
                    "<td class='td'>"+obj.achievementScore+"</td>"+
                    "<td class='tk' data-toggle=\"modal\" data-target=\"#myModal2\" onclick=showModal('"+obj.studentId+"','"+obj.achievementId+"',"+"'edit'"+")>编辑</td>"+
                    "<td class='tk' onclick=deleteSubjectScore('"+obj.studentId+"','"+obj.achievementId+"')>删除</td>"+
                    "</tr>"
            }
            document.getElementById("subjectScore").innerHTML=html;
            if(userList.length==0){
                swal("无信息");
                return;
            }
        });
        console.log(userList);
        return userList;
    }


    function showModal(studentId,achievementId,type) {
        console.log(studentId);
        if(type == "edit"){

            document.getElementById("myModalLabel2").innerHTML = "编辑学生科技成果信息";
            var html = "";

            $.get("/admin/getAchievement", {studentId: studentId,achievementId:achievementId}, function (data) {

                var obj = eval("(" + data.data + ")");

                html+= "<input type='text' hidden id='id' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' value="+obj.studentId+">"+
                        "科技成果编号:<input type='text' maxlength='2' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='achievementId' value="+obj.achievementId+">"+
                        "科技成果描述;<input type='text' maxlength='100' required style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='achievementDescription' value="+obj.achievementDescription+">"+
                        "科技成果得分:<input type='text' maxlength='10' required style='width: 100%;height:3rem;margin-bottom: 1rem;' id='achievementScore' value="+obj.achievementScore+">";

                document.getElementById("modalBody2").innerHTML = html;

            });

        }
    }

    function addSubjectScoreModal() {

        document.getElementById("myModalLabel3").innerHTML = "新增学生成绩信息";
        var html = "";

        html+="学号;<input type='text' required id='id1' style='width: 100%;height: 3rem;margin-bottom: 1rem;'>"+
            "科技成果编号;<input type='text' required maxlength='10' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='achievementId1'>"+
            "科技成果描述:<input type='text' required maxlength='100' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='achievementDescription1' >"+
            "科技成果得分;<input type='text'  required maxlength='3' style='width: 100%;height: 3rem;margin-bottom: 1rem;' id='achievementScore1' >";
        document.getElementById("modalBody3").innerHTML = html;
    }


    function addSubjectScore() {

        var studentId = document.getElementById("id1").value;

        var achievementId = document.getElementById("achievementId1").value;

        $.get("/admin/getAchievement", {studentId: studentId,achievementId:achievementId}, function (data) {

            var obj = eval("(" + data.data + ")");
            if(obj!=null){
                swal("该学号学生科技成果信息已存在!");
                return;
            }

        });
        $.get("/admin/getStudentInfo", {studentId: studentId,}, function (data) {

            var obj = eval("(" + data.data + ")");
            if(obj==null){
                swal("该学号学生不存在!");
                return;
            }

        });


        var achievementDescription = document.getElementById("achievementDescription1").value;
        var achievementScore = document.getElementById("achievementScore1").value;

        if(studentId==""||achievementDescription==""||achievementScore==""){
            swal("有选项未填写");
            return;
        }
        if(achievementScore<0||achievementScore>100){
            swal("科技成果得分应在0-100");
            return;
        }


        $.post("/admin/addAchievements",{
                studentId: studentId,
                achievementId: achievementId,
                achievementDescription: achievementDescription,
                achievementScore: achievementScore
            },
            function (data) {
                if(data!=null&&data.data=="OK"){

                    swal("新增成功");
                    getAchievements()

                }else{
                    swal("新增失败");
                }
            });
    }

    function  updateSubjectScore() {

        var studentId = document.getElementById("id").value;
        var achievementId = document.getElementById("achievementId").value;
        var achievementDescription = document.getElementById("achievementDescription").value;
        var achievementScore = document.getElementById("achievementScore").value;

        if(studentId==""||achievementId==""||achievementDescription==""||achievementScore==""){
            swal("有选项未填写");
            return;
        }
        if(achievementScore<0||achievementScore>100){
            swal("科技成果得分应在0-100");
            return;
        }


        $.post("/admin/updateAchievements",{
            studentId: studentId,
            achievementId: achievementId,
            achievementDescription: achievementDescription,
            achievementScore: achievementScore
        },function (data) {
            if(data!=null&&data.data=="OK"){

                swal("更新成功");
                getAchievements()

            }else{
                swal("更新失败");
            }
        });


    }
    function deleteSubjectScore(studentId,achievementId) {
        swal({
                title: "Are you sure?",
                text: "Your will not be able to recover this studentInfo!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!" },
            function(){
                $.get("/admin/deleteAchievement", {studentId: studentId,achievementId:achievementId}, function (data) {

                    if(data!=null&&data.data=="OK"){

                        swal("删除成功");
                        getAchievements()

                    }else{
                        swal("删除失败");
                    }
                });
            });
    }

</script>

</body>

</html>