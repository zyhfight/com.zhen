<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Expires" content="0">
    <title>Title</title>

    <link rel="stylesheet" type="text/css" href="static/util/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="static/util/css/sweet-alert.css" />
    <link rel="stylesheet" type="text/css" href="static/css/form.css" />

    <style type="text/css">

        /*body, th, td {*/
           /*border-color: #99D3F5;*/
        /*}*/

        th{
            width: 200px;
        }

    </style>
</head>
<body>

<div style="margin-top:2rem">
    <table border="1" align="center">
        <tr style="width: 100%">
            <th>输出格式</th>
            <td>
                <select name="out_type" id="out_type" style="width: 100%">
                    <option value="image/jpeg" selected="selected">画像(JPEG)</option>
                    <option value="image/png">画像(PNG)</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>文本</th>
            <td>
                <textarea  id="text" name="text" rows="5" cols="40"></textarea>
            </td>
        </tr>
        <tr>
            <th>纠错等级</th>
            <td>
                <select name="error_correct" id="error_correct" style="width: 100%">
                    <option value="L" selected>L 7%</option>
                    <option value="M">M 15%</option>
                    <option value="Q">Q 25%</option>
                    <option value="H">H 30%</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>编码量级</th>
            <td>
                <select name="qr_code_level" id="qr_code_level" style="width: 100%">
                    <option value="0">自动</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>

                </select>
            </td>
        </tr>
    </table>
</div>
<div style="margin-top:1rem" align="center">

    <a href="javascript:;" class="file">

        <input id="fileToUpload" type="file" size="45" name="fileToUpload"
           class="input">上传LOGO

    </a>

    <a href="javascript:;" class="file">

        <div onclick="uploadImage()">生成二维码</div>

    </a>

</div>

<div id="qr_code_result" style="border-top:1px solid #000;margin-top: 1rem">

</div>

<script src="static/util/js/jquery-3.1.1.min.js"></script>
<script src="static/util/js/bootstrap.min.js"></script>
<script src="static/util/js/sweet-alert.min.js"></script>
<script src="static/js/form.js"></script>
<script type="text/javascript" src="static/util/js/ajaxUpload/jquery.js"></script>
<script type="text/javascript" src="static/util/js/ajaxUpload/ajaxfileupload.js"></script>

<script>
    $(document).ready(function () {

//        var html = "";
//        var number = 1;
//        for(var i = 0; i<32; i++){
//            html +=  "<option value=" + number + ">" + number + "</option>";
//            number++;
//        }
//
//        document.getElementById("offset").innerHTML = html;

    });


    function uploadImage() {

        var outType = $("#out_type").val();

        var text = $("#text").val();

        if(text == ""){
            swal("文本不能为空");
            return;
        }

        var errorCorrectLevel = $("#error_correct").val();

        var qrCodeLevel = $("#qr_code_level").val();

        var offset = 1;

        var size = 3;

        $.ajaxFileUpload({
            url : 'qr_code/upload_file',
            secureuri : false,
            fileElementId : 'fileToUpload',
            dataType : 'json',
            data : {
                outType:outType,
                text:text,
                errorCorrectLevel:errorCorrectLevel,
                qrCodeLevel:qrCodeLevel,
                offset:offset,
                size:size
            },
            success : function(data, status) {

                var imgList = eval(data.result);

                var html = "";

                console.log(imgList);

                if(outType == "image/jpeg"){

                    for(var key in imgList){

                        var str = imgList[key];

                        html +="<img src='data:imge/jpeg;base64,"+ str +"' alt='load fail' style='margin: 1rem 1rem 1rem 1rem'>";

                    }

                }else{

                    for(var key in imgList){

                        var str = imgList[key];

                        html +="<img src='data:imge/jpeg;base64,"+ str +"' alt='load fail' style='margin: 1rem 1rem 1rem 1rem'>";

                    }

                }

                document.getElementById("qr_code_result").innerHTML = html;
            },
            error : function(data, status, e) {
               swal('上传出错');
            }
        });

    }



</script>

</body>
</html>